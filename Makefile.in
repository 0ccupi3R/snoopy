# Makefile for snoopy
# $Id: Makefile.in 21 2010-02-11 19:58:54Z bostjanskufca $



CC=@CC@
CFLAGS=@CFLAGS@ @DEFS@
LIBS=-ldl
LDFLAGS=@LDFLAGS@ @LIBS@
prefix=@prefix@
exec_prefix=@exec_prefix@
LIBDIR=@libdir@



all: snoopy.so detect

snoopy.so:  snoopy.c snoopy.h
	$(CC) $(CFLAGS) -shared -O3 -fomit-frame-pointer -fPIC snoopy.c -osnoopy.so $(LDFLAGS)

detect: detect.c
	$(CC) detect.c -odetect $(LDFLAGS)



install: all
	install -m 755 -d $(DESTDIR)$(LIBDIR)
	install -m 755 snoopy.so $(DESTDIR)$(LIBDIR)/snoopy.so
	@echo -e "\nSnoopy shared library installed in $(DESTDIR)$(LIBDIR)."
	@echo -e "Run 'make enable' to actually enable snoopy logging.\n"



enable:
	./enable.sh $(DESTDIR)$(LIBDIR)



clean:
	rm -f detect snoopy.so
	rm -f contrib/sles/snoopy.spec

distclean: clean
	rm -f autoscan.log config.h config.log config.status
	rm -rf autom4te.cache
	rm -f Makefile

realclean: distclean
	rm -f configure configure.scan
